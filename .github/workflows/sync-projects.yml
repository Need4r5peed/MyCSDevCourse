name: Auto-Sync to FinalTasks
on:
  push:
    branches: [master]
    paths:
      - 'Module/Module9/Unit6/Module9.Unit6.FinalTask1/**'
      - 'Module/Module9/Unit6/Module9.Unit6.FinalTask2/**'

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Sync Files
        env:
          SRC_DIR: "${{ github.workspace }}/Module/Module9/Unit6"
          TARGET_REPO: "https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/Need4r5peed/Module9.Unit6.FinalTasks.git"
        run: |
          # Создаем временный каталог
          mkdir -p ../sync-temp
          cd ../sync-temp
          
          # Клонируем целевой репозиторий
          git clone $TARGET_REPO .
          
          # Синхронизируем файлы
          rsync -av --delete \
            "$SRC_DIR/Module9.Unit6.FinalTask1/" \
            "./Module9.Unit6.FinalTask1/"
            
          rsync -av --delete \
            "$SRC_DIR/Module9.Unit6.FinalTask2/" \
            "./Module9.Unit6.FinalTask2/"

          # Фиксируем изменения
          git add .
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "Auto-sync: ${{ github.sha }}"
            git push origin master
          else
            echo "Нет изменений для коммита"
          fi
